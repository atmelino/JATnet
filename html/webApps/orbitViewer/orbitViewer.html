<!doctype html>
<html lang="en">
<head>
<title>GUI (Three.js)</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<link rel=stylesheet href="../css/base.css" />
<link rel=stylesheet href="../css/jquery-ui.css" />
<link rel=stylesheet href="../css/info.css" />

<script src="../js/Three.js"></script>
<script src="../js/Detector.js"></script>
<script src="../js/Stats.js"></script>
<script src="../js/OrbitControls.js"></script>
<script src="../js/THREEx.KeyboardState.js"></script>
<script src="../js/THREEx.FullScreen.js"></script>
<script src="../js/THREEx.WindowResize.js"></script>
<script src='../js/DAT.GUI.min.js'></script>
<script src="../js/jquery-1.9.1.js"></script>
<script src="../js/jquery-ui.js"></script>
<script src="../js/info.js"></script>
<script src="../fonts/gentilis_bold.typeface.js"></script>
<script src="../fonts/gentilis_regular.typeface.js"></script>
<script src="../fonts/optimer_bold.typeface.js"></script>
<script src="../fonts/optimer_regular.typeface.js"></script>
<script src="../fonts/helvetiker_bold.typeface.js"></script>
<script src="../fonts/helvetiker_regular.typeface.js"></script>
<script src="../fonts/droid_sans_regular.typeface.js"></script>
<script src="../fonts/droid_sans_bold.typeface.js"></script>
<script src="../fonts/droid_serif_regular.typeface.js"></script>
<script src="../fonts/droid_serif_bold.typeface.js"></script>

<script src="../js/extra/axisLabels.js"></script>



<script>
	// MAIN
	// standard global variables
	var container, scene, camera, renderer, controls, stats;
	var keyboard = new THREEx.KeyboardState();
	var clock = new THREE.Clock();

	// custom global variables
	var cube;
	var radius = 6370;
	var gridSize = 10000;
	//var radius = 100;
	//var gridSize = 200;
	var parameters;
	var gui;

	function setup() {
		// initialization
		init();

		// animation loop / game loop
		animate();

	}

	// FUNCTIONS 		
	function init() {
		// SCENE
		scene = new THREE.Scene();

		// CAMERA
		var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
		var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 1000 * gridSize;
		camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
		scene.add(camera);
		camera.position.set(radius * 5, 3.5 * radius, 4 * radius);
		camera.lookAt(scene.position);

		// RENDERER
		if (Detector.webgl)
			renderer = new THREE.WebGLRenderer({
				antialias : true
			});
		else
			renderer = new THREE.CanvasRenderer();
		renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
		container = document.getElementById('ThreeJS');
		container.appendChild(renderer.domElement);

		// EVENTS
		THREEx.WindowResize(renderer, camera);
		THREEx.FullScreen.bindKey({
			charCode : 'm'.charCodeAt(0)
		});
		// CONTROLS
		controls = new THREE.OrbitControls(camera, renderer.domElement);
		controls.autoRotate = true;
		controls.autoRotateSpeed = 0.2;

		// STATS
		stats = new Stats();
		stats.domElement.style.position = 'absolute';
		stats.domElement.style.bottom = '0px';
		stats.domElement.style.zIndex = 100;
		container.appendChild(stats.domElement);

		// LIGHT
		var light = new THREE.PointLight(0xffffff);
		light.position.set(0, 250, 0);
		scene.add(light);

		// GUI
		gui = new dat.GUI();
		parameters = {
			a : 12000, // numeric
			ecc : 0.3, // numeric slider
			inc : 23, // numeric slider
			add : makeOrbit,
		};
		gui.add(parameters, 'a').name('Semimajor Axis [km]');
		gui.add(parameters, 'ecc').min(0).max(1).step(0.01).name('Eccentricity');
		gui.add(parameters, 'inc').min(0).max(180).step(0.1).name('Inclination');
		gui.add(parameters, 'add').name('Add Orbit');
		gui.open();

		// SKYBOX/FOG
		var skyBoxGeometry = new THREE.CubeGeometry(1000 * gridSize, 1000 * gridSize, 1000 * gridSize);
		var skyBoxMaterial = new THREE.MeshBasicMaterial({
			color : 0x9999ff,
			side : THREE.BackSide
		});
		var skyBox = new THREE.Mesh(skyBoxGeometry, skyBoxMaterial);
		scene.add(skyBox);
		//scene.fog = new THREE.FogExp2(0x9999ff, 0.00025);

		////////////
		// CUSTOM //
		////////////

		document.addEventListener('mousedown', onDocumentMouseDown, false);

		// Create the Earth with nice texture
		var sphereGeo = new THREE.SphereGeometry(radius, 64, 32);
		var colors = THREE.ImageUtils.loadTexture("../images/earth-day.jpg");
		var earthMaterial = new THREE.MeshBasicMaterial({
			color : 0xffffff,
			map : colors
		});
		this.earthSphere = new THREE.Mesh(sphereGeo, earthMaterial);
		scene.add(earthSphere);

		var gridXZ = new THREE.GridHelper(gridSize, gridSize / 2);
		gridXZ.setColors(new THREE.Color(0x006600), new THREE.Color(0x006600));
		gridXZ.position.set(0, -gridSize, 0);
		//gridXZ.position.set(-gridSize / 2, -gridSize, -gridSize);
		scene.add(gridXZ);

		var gridXY = new THREE.GridHelper(gridSize, gridSize / 2);
		gridXY.position.set(0, 0, -gridSize);
		//gridXY.position.set(gridSize, gridSize, -gridSize);
		gridXY.rotation.x = Math.PI / 2;
		gridXY.setColors(new THREE.Color(0x000066), new THREE.Color(0x000066));
		scene.add(gridXY);

		var gridYZ = new THREE.GridHelper(gridSize, gridSize / 2);
		gridYZ.position.set(-gridSize, 0, 0);
		gridYZ.rotation.z = Math.PI / 2;
		gridYZ.setColors(new THREE.Color(0x660000), new THREE.Color(0x660000));
		scene.add(gridYZ);

		// create a set of coordinate axes to help orient user
		//    specify length in pixels in each direction
		var axes = new THREE.AxisHelper(gridSize);
		scene.add(axes);

		makeAxisLabel(scene);

		// 		var lineGeometry = new THREE.Geometry();
		// 		var vertArray = lineGeometry.vertices;
		// 		for ( var i = 0; i < 12; i++) {
		// 			vertArray.push(new THREE.Vector3(Math.random() * i * 1000, Math.random() * i * 1000, Math.random() * i * 1000));
		// 		}
		// 		lineGeometry.computeLineDistances();
		// 		var lineMaterial = new THREE.LineBasicMaterial({
		// 			color : 0xcc0000
		// 		});
		// 		var line = new THREE.Line(lineGeometry, lineMaterial);
		// 		scene.add(line);

	}
	function onDocumentMouseDown(event) {
		//console.log("Click.");
		controls.autoRotate = false;
	}

	function animate() {
		requestAnimationFrame(animate);
		render();
		update();
	}

	function update() {
		if (keyboard.pressed("z")) {
			// do something
		}

		//earthSphere.rotation.y += 0.0010;
		controls.update();
		stats.update();
	}

	function render() {
		renderer.render(scene, camera);
	}

	function makeOrbit() {
		//console.log("clicked");
		var SemimajorAxis = parameters.a;
		var Eccentricity = parameters.ecc;
		var Inclination = parameters.inc;
		console.log("SemimajorAxis=" + SemimajorAxis);

		$.post('/JATServlet/TwoBodyParam', {
			SemimajorAxis : SemimajorAxis,
			Eccentricity : Eccentricity,
			Inclination : Inclination
		}, function(responseText) {

			var obj = JSON.parse(responseText);
			//printlnMessage('messages', JSON.stringify(obj));
			//printlnMessage('messages', obj.coords.x[0]);
			//printlnMessage('messages', JSON.stringify(obj.TBE));
			console.log(JSON.stringify(obj.TBE));

			var lineGeometry = new THREE.Geometry();
			var vertArray = lineGeometry.vertices;
			for ( var i = 0; i < obj.coords.x.length; i++) {
				point = new THREE.Vector3(obj.coords.x[i], obj.coords.y[i], obj.coords.z[i]);
				vertArray.push(point);

			}
			lineGeometry.computeLineDistances();
			var lineMaterial = new THREE.LineBasicMaterial({
				color : 0xcc0000
			});
			var line = new THREE.Line(lineGeometry, lineMaterial);
			scene.add(line);

		});
	}
</script>

</head>
<body onLoad="setup();">
	<div id="infoButton"></div>
	<div id="infoBox" title="Demo Information">
		Java Astrodynamics Toolkit</a>
	</div>
	<!-- ------------------------------------------------------------ -->

	<div id="ThreeJS" style="position: absolute; left: 0px; top: 0px"></div>

</body>
</html>
